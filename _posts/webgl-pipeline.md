# 渲染管线 {#WebGL-pipeline}

## 一、概念

渲染管线(Rendering Pipeline)是计算机图形学中的一个非常重要的概念，它描述了从原始的几何数据（如顶点，纹理等）到最终显示在屏幕上的图像的整个处理过程。这个过程可以分为多个阶段，每个阶段都有特定的任务和功能。

## 二、概述

渲染管线可以分为两大类：固定管线（Fixed Pipeline）和可编程管线（Programmable Pipeline）。

1. 固定管线：在早期的图形硬件中，渲染管线是固定的，开发者无法直接修改管线中的处理步骤。这种管线虽然简单，但灵活性较差，无法实现复杂的图形效果。
2. 可编程管线：随着图形硬件的发展，现代图形硬件（如GPU）支持可编程管线。开发者可以通过编写着色器（Shader）代码来控制管线中的某些阶段，从而实现各种复杂的图形效果。

## 三、现代渲染管线的主要阶段

### 1. 顶点着色器（Vertex Shader）

* 输入：顶点数据（如顶点位置，法线，纹理坐标等）
* 处理：对每个顶点进行变换，如模型变换，视图变换，投影变换等。还可以对顶点进行光照计算，动画处理等。
* 输出：变换后的顶点数据，包括顶点位置，法线，纹理坐标等。

### 2. 图元组装（Primitive Assembly）

* 输入：顶点着色器输出的顶点坐标。
* 处理：将顶点数组组装成图元（如点，线，三角形等）。如果启用了裁剪（Clipping），还会在这一阶段对图元进行裁剪，以确保它们在视口范围内。
* 输出：裁剪后的图元。

### 3. 光栅化（Rasterization）

* 输入：裁剪后的图元。
* 处理：将图元转成像素（Fragment）。这个过程包括确定图元覆盖的像素区域，并为每个像素生成一个片段（Fragment）。片段包含像素的位置，颜色，纹理坐标等。
* 输出：片段数据。

### 4. 片段着色器（Fragment Shader）

* 输入：片段数据。
* 处理：对每个片段进行处理，如纹理映射，光照计算，颜色混合等。这是实现各种复杂视觉效果的关键阶段。
* 输出：最终的像素颜色。

### 5. 像素操作（Pixel Operations）

* 输入：片段着色器输出的像素颜色
* 处理：包括深度测试（Depth Test），模板测试（Stencil Test），颜色混合（Blending）等，这些操作用于确定最终显示在屏幕上的像素颜色。
* 输出：最终的像素颜色，写入帧缓冲区（Frame Buffer）

## 四、渲染管线的灵活性

1. 着色器编程：开发者可以通过编写顶点着色器和片段着色器来控制渲染过程。这使得开发者可以实现各种复杂的图形效果。如高级光照模型，阴影，反射，折射等。
2. 可配置的管线阶段：除了着色器阶段，渲染管线的其他阶段（如裁剪，深度测试等）也可以通过API进行配置，以满足不同要求。
